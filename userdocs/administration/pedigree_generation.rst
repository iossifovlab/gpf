Pedigree Generation Guide
=========================


Brief outline
#############

Starting off with a pedigree file that contains information about families and their individuals, we will run the file through two tools - the first one will add a column to the pedigree file - a layout column that contains the coordinates of each individual in the pedigree drawing that will be produced - and the second tool will generate a PDF file which contains the pedigree drawing, as well as some optional info.

This guide covers most cases; some specific notes regarding usage with studies containing multigenerational pedigrees are given at the end.


Prerequisites
#############

You will need a pedigree file (usually found with a .ped extension), which is a text file with delimiter-separated values (comma, tab, etc.), that contains the following columns:

Family ID:
  The values in this column must contain valid family IDs.
ID:
  IDs for separate individuals.
Father ID:
  A column that specifies the ID of the individual's father.
Mother ID:
  A column that specifies the ID of the individual's mother.
Sex:
  The sex of the individual.
Status:
  A column that specifies the status of the individual - whether he is affected or not.
Role:
  The role of the individual within his family.


Preparing the pedigree data
###########################

The pedigree data may require preparation beforehand. This section describes the requirements for pedigree data that must be met in order to use the tools.

In some cases, the initial pedigree file must be expanded with additional individuals in order to correctly form some families. Following that, individuals must be connected to their parents from the newly added individuals.

Next, we need to replace the values in the sex, role and status columns with those used by the GPF system -
:ref:`sex <allowed_values_sex>`, :ref:`role <allowed_values_role>`, :ref:`status <allowed_values_status>`.

Adding the layout column
########################

You will need to use the tool 'save_pedigree.py', which can be found in 'DAE/tools'.

The tool has a '-h' or '--help' option, which brings out a list of possible arguments and brief descriptions.

For most cases, the default values should be sufficient, but it is recommended to look through and make sure.

.. code-block:: bash

    save_pedigree.py inital_pedigree_file.ped -o output_pedigree_file.ped


Adding a status to generated individuals
########################################

Generated and added individuals must have a '-' status to indicate their origin. This will result in them being colored gray in the pedigree drawing. Individuals that are generated by the save_pedigree tool will have their status set to '-' automatically, but individuals that are added must have their status manually set to '-' beforehand. A script should be ran after save_pedigree to indicate individuals with the '-' status as generated, by setting the appropriate values in the 'generated' column.


Drawing the pedigree
####################

Next, you will need the tool 'draw_pedigree', which can be found again in 'DAE/tools'.

As before, this tool has a help argument detailing its arguments.

You will need to use the output pedigree file from the previous step.

.. code-block:: bash

    draw_pedigree.py pedigree_file_with_layout.ped -o pedigree_drawing.pdf


Some notes regarding multigenerational pedigrees
################################################

Generating a pedigree layout and drawing for multigenerational pedigrees involves more steps, and problems may occur during the process. 

Potential errors during layout generation
*****************************************

Although uncommon, errors can occur during layout generation (save_pedigree.py tool). Problems are usually caused by incomplete families. Single, detached individuals are not a problem, as they will be drawn in a separate group containing only that individual. However, an incomplete family - one that is missing an individual to make a connection between two multi-individual groups - will cause problems. This is resolved either by adding additional existing individuals or generation of dummy individuals.

If errors are encountered, the pedigree file will be generated, but some entries in the layout column will contain an error message instead of coordinates. Resolving this is done through manual insertion of layout coordinates.
