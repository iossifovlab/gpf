version: "3.9"
services:
    
  impala:
    image: seqpipe/seqpipe-docker-impala:latest
    hostname: impala
    restart: "no"
    ports:
      - "21050:21050"
      - "8020:8020"

  setup:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        REGISTRY: "registry.seqpipe.org/"
    depends_on:
      - impala
    restart: "no"
    environment:
      DAE_DB_DIR: /data
      GRR_DEFINITION_FILE: /wd/integration/grr_definition.yaml
    volumes:
      - .:/wd
      - ./integration/local/data:/data
    entrypoint: /wd/integration/local/entrypoint.sh


  remote:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        REGISTRY: "registry.seqpipe.org/"
    depends_on:
      - impala
    ports:
      - "21010:21010"
    environment:
      DAE_DB_DIR: /data/
      GRR_DEFINITION_FILE: /wd/integration/grr_definition.yaml
    volumes:
      - .:/wd
      - ./integration/remote/data:/data

    entrypoint: /wd/integration/remote/entrypoint.sh
