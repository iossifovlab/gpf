version: "3.9"
services:
    
  impala:
    image: seqpipe/seqpipe-docker-impala:latest
    hostname: impala
    restart: "no"
    ports:
      - "21050:21050"
      - "8020:8020"

  mail:
    image: mailhog/mailhog
    hostname: mail
    ports:
      - "1025:1025"
      - "8025:8025"

  setup:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        REGISTRY: "registry.seqpipe.org/"
    depends_on:
      - impala
    restart: "no"
    environment:
      DAE_DB_DIR: /wd/data/data-hg19-local
      GRR_DEFINITION_FILE: /wd/integration/grr_definition.yaml
      DAE_IMPALA_HOST: impala
      DAE_HDFS_HOST: impala
      TEST_REMOTE_HOST: gpfremote
    volumes:
      - .:/wd
    entrypoint: /wd/integration/local/entrypoint.sh


  remote:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        REGISTRY: "registry.seqpipe.org/"
    depends_on:
      - impala
      - setup
    ports:
      - "21010:21010"
    environment:
      DAE_DB_DIR: /wd/data/data-hg19-remote
      GRR_DEFINITION_FILE: /wd/integration/grr_definition.yaml
      DAE_IMPALA_HOST: impala
      DAE_HDFS_HOST: impala
      TEST_REMOTE_HOST: gpfremote
    volumes:
      - .:/wd

    entrypoint: /wd/integration/remote/entrypoint.sh
